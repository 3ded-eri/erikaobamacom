---
---

<div id="my_dataviz" class="size-full m-auto"></div>

<script type="module">
  // import * as d3 from "d3";
import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";

// set the dimensions and margins of the graph
const margin = {top: 50, right: 50, bottom: 50, left: 50},
  width = 1000,
  height = 800;

// append the svg object to the body of the page
const svg = d3.select("#my_dataviz")
.append("svg")
  .attr("preserveAspectRatio", "xMidYMid meet")
  .attr("viewBox", `0 0 ${width} ${height}`)
  .attr("class", "m-auto size-full");

const zoomContainer = svg.append("g")
  .attr("transform",
        `translate(-${margin.left}, -${margin.top})`);

const data = {
  "nodes": [
    {
      "id": 10,
      "catname": "Illustration",
      "type": "category",
      "tool": "Photoshop, Krita, Painter, Procreate Pocket, Watercolor (analog)"
    },
    {
      "id": 11,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "il_2001",
      "type": "work",
      "ext": "jpg",
      "desc": "An early digital illustration (2001)"
    },
    {
      "id": 12,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "il_2009",
      "type": "work",
      "ext": "webp",
      "desc": "Digital illustration (2009)"
    },
    {
      "id": 13,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "il_2014-1",
      "type": "work",
      "ext": "webp",
      "desc": "Sketch (2014)"
    },
    {
      "id": 14,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "il_2014-2",
      "type": "work",
      "ext": "webp",
      "desc": "Digital illustration (2014)"
    },
    {
      "id": 15,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "il_2016",
      "type": "work",
      "ext": "webp",
      "desc": "Messaging sticker (2016)"
    },
    {
      "id": 16,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "il_2017",
      "type": "work",
      "ext": "webp",
      "desc": "Mobile wallpaper illustration (c. 2017)"
    },
    {
      "id": 17,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "il_2017-3",
      "type": "work",
      "ext": "webp",
      "desc": "Mobile stickers and emojis (c. 2017)"
    },
    {
      "id": 18,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "il_2018",
      "type": "work",
      "ext": "webp",
      "desc": "Commercial illustration (2018)"
    },
    {
      "id": 20,
      "catname": "Graphic Design",
      "type": "category",
      "tool": "Photoshop, Illustrator"
    },
    {
      "id": 21,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "gd_2017",
      "type": "work",
      "ext": "webp",
      "desc": "Graphic design (2017)"
    },
    {
      "id": 22,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "gd_2018",
      "type": "work",
      "ext": "webp",
      "desc": "Graphic design (2018)"
    },
    {
      "id": 30,
      "type": "category",
      "catname": "3D modeling",
      "tool": "Blender, Maya, Substance Painter, Forger"
    },
    {
      "id": 31,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "3d_2007-1",
      "type": "work",
      "ext": "webp",
      "desc": "University project (2007)"
    },
    {
      "id": 32,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "3d_2007-2",
      "type": "work",
      "ext": "webp",
      "desc": "University project (2007)"
    },
    {
      "id": 33,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "3da_2023-2",
      "type": "work",
      "ext": "webm",
      "desc": "3D animation (2023)"
    },
    {
      "id": 40,
      "catname": "2D animation",
      "type": "category",
      "tool": "Photoshop, After Effects"
    },
    {
      "id": 41,
      "path": "/src/images/portfolio/",
      "name": "ifk-pixel-art-animation",
      "type": "work",
      "ext": "webm",
      "desc": "Emoji animation (c. 2016)"
    },
    {
      "id": 50,
      "catname": "3D animation",
      "type": "category",
      "tool": "Blender, Unreal Engine"
    },
    {
      "id": 51,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "3da_2021",
      "type": "work",
      "ext": "webm",
      "desc": "Geometry Nodes breakdown (2021)"
    },
    {
      "id": 52,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "3da_2023-1",
      "type": "work",
      "ext": "webm",
      "desc": "3D animation (2023)"
    },
    {
      "id": 60,
      "catname": "Motion graphics",
      "type": "category",
      "tool": "After Effects, Premiere Pro, DaVinci Resolve"
    },
    {
      "id": 61,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "ve_2021",
      "type": "work",
      "ext": "webm",
      "desc": "2D + 3D animation (2021)"
    },
    {
      "id": 70,
      "catname": "Photo editing",
      "type": "category",
      "tool": "Photoshop, Lightroom, Darkroom"
    },
    {
      "id": 80,
      "catname": "Web design",
      "type": "category",
      "tool": "Figma, XD, Photoshop, Illustrator"
    },
    {
      "id": 81,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "wd_2004-1",
      "type": "work",
      "ext": "png",
      "desc": "School project (2004)"
    },
    {
      "id": 82,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "wd_2004-2",
      "type": "work",
      "ext": "png",
      "desc": "School project (2004)"
    },
    {
      "id": 83,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "wd_2006",
      "type": "work",
      "ext": "gif",
      "desc": "Personal website design (2006)"
    },
    {
      "id": 84,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "wd_2009",
      "type": "work",
      "ext": "webp",
      "desc": "Personal website design (2009)"
    },
    {
      "id": 85,
      "path": "/src/images/portfolio/",
      "name": "enhance-low-code-design",
      "type": "work",
      "ext": "webp",
      "desc": "Graphic design for a website (2024)"
    },
    {
      "id": 90,
      "catname": "Website development",
      "type": "category",
      "tool": "Visual Studio Codem WSL2, Git"
    },
    {
      "id": 91,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "wdev_2025",
      "type": "work",
      "ext": "webm",
      "desc": "Astro code example (2025)"
    },
    {
      "id": 100,
      "catname": "Graphic programming",
      "type": "category",
      "tool": "Processing, Geometry Nodes (Blender), Stable Diffusion"
    },
    {
      "id": 101,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "processing_2007-1",
      "type": "work",
      "ext": "png",
      "desc": "University project (2007)"
    },
    {
      "id": 102,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "processing_2007-2",
      "type": "work",
      "ext": "png",
      "desc": "University project (2007)"
    },
    {
      "id": 103,
      "path": "/src/images/posts/4_fundamental-skills/",
      "name": "ai_2023",
      "type": "work",
      "ext": "webm",
      "desc": "AI-rendered 3D particle animation (2023)"
    },
    {
      "id": 110,
      "catname": "Print design",
      "type": "category",
      "tool": "Illustrator, InDesign"
    },
    {
      "id": 120,
      "catname": "UX/UI design",
      "type": "category",
      "tool": "Figma"
    }
  ],
  "links": [
    {
      "source": 10,
      "target": 20
    },
    {
      "source": 10,
      "target": 30
    },
    {
      "source": 10,
      "target": 40
    },
    {
      "source": 10,
      "target": 70
    },
    {
      "source": 10,
      "target": 80
    },
    {
      "source": 11,
      "target": 10
    },
    {
      "source": 12,
      "target": 10
    },
    {
      "source": 13,
      "target": 10
    },
    {
      "source": 14,
      "target": 10
    },
    {
      "source": 15,
      "target": 10
    },
    {
      "source": 16,
      "target": 10
    },
    {
      "source": 17,
      "target": 10
    },
    {
      "source": 18,
      "target": 10
    },
    {
      "source": 41,
      "target": 10
    },
    {
      "source": 20,
      "target": 70
    },
    {
      "source": 20,
      "target": 80
    },
    {
      "source": 20,
      "target": 110
    },
    {
      "source": 20,
      "target": 120
    },
    {
      "source": 18,
      "target": 20
    },
    {
      "source": 21,
      "target": 20
    },
    {
      "source": 22,
      "target": 20
    },
    {
      "source": 85,
      "target": 20
    },
    {
      "source": 30,
      "target": 50
    },
    {
      "source": 30,
      "target": 80
    },
    {
      "source": 31,
      "target": 30
    },
    {
      "source": 32,
      "target": 30
    },
    {
      "source": 33,
      "target": 30
    },
    {
      "source": 52,
      "target": 30
    },
    {
      "source": 61,
      "target": 30
    },
    {
      "source": 102,
      "target": 30
    },
    {
      "source": 40,
      "target": 30
    },
    {
      "source": 40,
      "target": 60
    },
    {
      "source": 17,
      "target": 40
    },
    {
      "source": 41,
      "target": 40
    },
    {
      "source": 61,
      "target": 40
    },
    {
      "source": 50,
      "target": 60
    },
    {
      "source": 50,
      "target": 100
    },
    {
      "source": 33,
      "target": 50
    },
    {
      "source": 51,
      "target": 50
    },
    {
      "source": 52,
      "target": 50
    },
    {
      "source": 61,
      "target": 50
    },
    {
      "source": 103,
      "target": 50
    },
    {
      "source": 61,
      "target": 60
    },
    {
      "source": 103,
      "target": 60
    },
    {
      "source": 22,
      "target": 70
    },
    {
      "source": 80,
      "target": 90
    },
    {
      "source": 80,
      "target": 120
    },
    {
      "source": 81,
      "target": 80
    },
    {
      "source": 82,
      "target": 80
    },
    {
      "source": 83,
      "target": 80
    },
    {
      "source": 84,
      "target": 80
    },
    {
      "source": 85,
      "target": 80
    },
    {
      "source": 90,
      "target": 50
    },
    {
      "source": 90,
      "target": 80
    },
    {
      "source": 90,
      "target": 100
    },
    {
      "source": 91,
      "target": 90
    },
    {
      "source": 81,
      "target": 90
    },
    {
      "source": 82,
      "target": 90
    },
    {
      "source": 83,
      "target": 90
    },
    {
      "source": 84,
      "target": 90
    },
    {
      "source": 85,
      "target": 90
    },
    {
      "source": 100,
      "target": 80
    },
    {
      "source": 51,
      "target": 100
    },
    {
      "source": 91,
      "target": 100
    },
    {
      "source": 101,
      "target": 100
    },
    {
      "source": 102,
      "target": 100
    },
    {
      "source": 103,
      "target": 100
    },
    {
      "source": 110,
      "target": 120
    },
    {
      "source": 18,
      "target": 110
    },
    {
      "source": 22,
      "target": 110
    },
    {
      "source": 91,
      "target": 120
    }
  ]
};


// d3.json("../../../src/components/posts/4_fundamental-skills/4_graph-data.json").then( function( data) {

  // Filter nodes and links based on type
  const filteredNodesCategory = data.nodes.filter(d => d.type === "category");

  const filteredLinksCategory = data.links.filter(d => {
    const sourceNode = data.nodes.find(node => node.id === d.source);
    const targetNode = data.nodes.find(node => node.id === d.target);
    return sourceNode.type === "category" && targetNode.type === "category";
  });

  const filteredNodesWork = data.nodes.filter(d => d.type === "work");

  const filteredNodesWorkImg = data.nodes.filter(d => d.type === "work" && d.ext !== "webm");
  const filteredNodesWorkVideo = data.nodes.filter(d => d.type === "work" && d.ext === "webm");

  const filteredLinksWork = data.links.filter(d => {
    const sourceNode = data.nodes.find(node => node.id === d.source);
    const targetNode = data.nodes.find(node => node.id === d.target);
    return sourceNode.type === "work" && targetNode.type === "category";
  });


  // Initialize the links
  const link = zoomContainer
    .selectAll()
    .data(filteredLinksCategory)
    .join("line")
      .style("stroke", "var(--hl-purple-lt)")
      .style("stroke-dasharray", "2, 3")

  const worklink = zoomContainer
    .selectAll()
    .data(filteredLinksWork)
    .join("line")
      .style("stroke", "var(--hl-purple-lt)")
      // .style("stroke-dasharray", "2, 5")

  // Initialize the nodes
  const image = zoomContainer  
    .selectAll()
    .data(filteredNodesWork)  // Use filtered nodes
    .join("svg")
        .attr("data-toggle", "modal")
        .attr("data-target", function(d) {
          return '#modal-' + d.name;
        })

const catname = zoomContainer
  .selectAll()
  .data(filteredNodesCategory)  // Use filtered nodes
  .join("text")
    .text(d => d.catname)
    .attr("class","min-h-10")
    .attr("class","text-lg font-medium")
    .style("font-family","heading")
    .style("fill", "var(--text-pink)")
    .style("z-index", "10")

  const catcircle = zoomContainer
    .selectAll()
    .data(filteredNodesCategory)  // Use filtered nodes
      .join("circle")
      .attr("r", 5)
      .style("fill", "var(--hl-purple-lt)")

  const toolname = zoomContainer
    .selectAll()
    .data(filteredNodesCategory)  // Use filtered nodes
    .join("text")
      .text(d => d.tool)
      .attr("class","min-h-10")
      .attr("class","text-xs")
      .style("font-family","heading")
      .style("fill", "var(--hl-green-dk)")
      .style("z-index", "10")

  const modalImg = d3.select('body')
    .selectAll()
    .data(filteredNodesWorkImg).enter()
    .append('div')
        .attr("id", function(d) {
          return 'modal-' + d.name;
        })
        .attr("aria-hidden", "true")
        .attr("class", "fixed antialiased inset-0 w-screen bg-slate-800 bg-opacity-75 flex justify-center items-center opacity-0 pointer-events-none transition-opacity duration-300 ease-out z-[9999]")
        .append("div")
          .attr("class", "bg-white text-center flex flex-col-reverse p-4 max-h-[calc(100vh-5rem)] overflow-auto rounded-lg scale-95 transition-transform duration-300 ease-out")
          .text(d => d.desc)
        .append("img")
            .attr("src", function(d){return d.path + d.name + '.' + d.ext;})
            .attr("class", "w-auto max-w-[calc(100vw-10rem)] h-auto max-h-[calc(100vh-10rem)] mb-2 last:mb-0")

      
  const modalVideo = d3.select('body')
    .selectAll()
    .data(filteredNodesWorkVideo).enter()
    .append('div')
        .attr("data-toggle", "modal")
        .attr("id", function(d) {
          return 'modal-' + d.name;
        })
        .attr("aria-hidden", "true")
        .attr("class", "fixed antialiased inset-0 w-screen bg-slate-800 bg-opacity-75 flex justify-center items-center opacity-0 pointer-events-none transition-opacity duration-300 ease-out z-[9999]")
        .append("div")
          .attr("class", "bg-white text-center flex flex-col-reverse p-4 max-h-[calc(100vh-5rem)] overflow-auto rounded-lg scale-95 transition-transform duration-300 ease-out")
          .text(d => d.desc)
        .append("video")
          .attr("src", function(d){return d.path + d.name + '.' + d.ext;})
          .attr("autoplay", "true")
          .attr("loop", "true")
          .attr("controls", "true")


  // Create a simulation with several forces.
  const simulation = d3.forceSimulation(data.nodes)
      .force("link", d3.forceLink(data.links).id(d => d.id))
      .force("charge", d3.forceManyBody())
      .force("charge", d3.forceManyBody().strength(-500))         // This adds repulsion between nodes. Play with the -400 for the repulsion strength
      .force("center", d3.forceCenter(width / 2, height / 2))
      .on("tick", ticked);



  // Add a drag behavior.
  image.call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));
  catcircle.call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));
  catname.call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));
  toolname.call(d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended));

  // Add a zoom behavior.
  svg.call(d3.zoom()
  .scaleExtent([0.5, 5])  // Limits zoom level (min, max)
  .on("zoom", (event) => {
    zoomContainer.attr("transform", event.transform);
  }));

  // This function is run at each iteration of the force algorithm, updating the nodes position.
  function ticked() {
    link
      .attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });

    worklink
      .attr("x1", function(d) { return d.source.x; })
      .attr("y1", function(d) { return d.source.y; })
      .attr("x2", function(d) { return d.target.x; })
      .attr("y2", function(d) { return d.target.y; });

    image
      .attr("x", function (d) { return d.x-25; })
      .attr("y", function(d) { return d.y-25; })
      .append("image")
        .attr("xlink:href", function(d) {
          return d.path + d.name + '_thumb.webp';
        })
        .attr("width", 50)
        .attr("height", 50)
        .style("transform-origin", "center");
 
    catcircle
         .attr("cx", function (d) { return d.x; })
         .attr("cy", function(d) { return d.y; });

    catname
      .attr("x", function (d) { return d.x+6; })
      .attr("y", function(d) { return d.y+12; });
   
    toolname
      .attr("x", function (d) { return d.x+6; })
      .attr("y", function(d) { return d.y+32; });
    
    modalImg
    modalVideo
  }

  // Reheat the simulation when drag starts, and fix the subject position.
  function dragstarted(event) {
    if (!event.active) simulation.alphaTarget(0.3).restart();
    event.subject.fx = event.subject.x;
    event.subject.fy = event.subject.y;
  }

  // Update the subject (dragged node) position during drag.
  function dragged(event) {
    event.subject.fx = event.x;
    event.subject.fy = event.y;
  }

  // Restore the target alpha so the simulation cools after dragging ends.
  // Unfix the subject position now that it’s no longer being dragged.
  function dragended(event) {
    if (!event.active) simulation.alphaTarget(0);
    event.subject.fx = null;
    event.subject.fy = null;
  }

  // When this cell is re-run, stop the previous simulation. (This doesn’t
  // really matter since the target alpha is zero and the simulation will
  // stop naturally, but it’s a good practice.)
  // invalidation.then(() => simulation.stop());

  // return svg.node();

// }).catch(function(error){
//      // handle error    
// });
</script>

<script src="https://unpkg.com/@material-tailwind/html@3.0.0-beta.7/dist/material-tailwind.umd.min.js" defer></script>
